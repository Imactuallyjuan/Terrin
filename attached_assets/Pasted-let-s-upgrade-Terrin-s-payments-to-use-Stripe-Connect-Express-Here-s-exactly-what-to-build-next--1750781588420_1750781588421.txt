letâ€™s upgrade Terrinâ€™s payments to use Stripe Connect Express. Hereâ€™s exactly what to build next:

âœ… 1ï¸âƒ£ Stripe Connect Express Onboarding for Contractors
Backend:

Add a new endpoint:

ts
Copy
Edit
POST /api/stripe/create-account-link
This:

Creates a Stripe Express account:

ts
Copy
Edit
const account = await stripe.accounts.create({
  type: 'express',
  country: 'US',
  email: contractor.email,
  capabilities: {
    card_payments: { requested: true },
    transfers: { requested: true },
  },
});
Store account.id as stripe_account_id in the contractors table.

Generate an account link:

ts
Copy
Edit
const accountLink = await stripe.accountLinks.create({
  account: account.id,
  refresh_url: `${YOUR_APP_URL}/reauth`,
  return_url: `${YOUR_APP_URL}/dashboard`,
  type: 'account_onboarding',
});
Respond with { url: accountLink.url }.

âœ… 2ï¸âƒ£ Contractor DB Schema
Add a column if missing:

sql
Copy
Edit
ALTER TABLE contractors ADD COLUMN stripe_account_id VARCHAR;
âœ… 3ï¸âƒ£ Contractor Dashboard
Add a clear button: â€œğŸ”— Set Up Payoutsâ€

Calls /api/stripe/create-account-link.

Redirects to the returned URL.

Once onboarding is done, save stripe_account_id permanently.

âœ… 4ï¸âƒ£ Update Payment Intents
When creating a Payment Intent for deposits, milestones, or custom payments:

ts
Copy
Edit
const paymentIntent = await stripe.paymentIntents.create({
  amount: amountInCents,
  currency: 'usd',
  payment_method_types: ['card'],
  application_fee_amount: platformFeeAmount, // optional
  transfer_data: {
    destination: contractorStripeAccountId, // from DB
  },
});
âœ… 5ï¸âƒ£ Payout & Compliance
Stripe automatically handles:

Identity verification (KYC)

Routing payments to contractorsâ€™ bank accounts

Issuing 1099-K forms if thresholds are met

Optional: Add a â€œView Payoutsâ€ link in the contractor dashboard:

Use the Connect Express Dashboard link:

ts
Copy
Edit
const loginLink = await stripe.accounts.createLoginLink(accountId);
âœ… 6ï¸âƒ£ What this achieves
âœ… Homeowners pay securely, with card on file
âœ… Contractors get paid directly to their bank
âœ… Stripe handles tax reporting and compliance
âœ… Terrin can take a platform fee automatically (optional)

âœ… 7ï¸âƒ£ Reminder:
ğŸ‘‰ We do NOT want contractors to create separate Stripe accounts manually.
ğŸ‘‰ They must use Connect Express via onboarding link only.
ğŸ‘‰ Payments must always use transfer_data.destination.

âœ… 8ï¸âƒ£ Final goal:
ğŸ¯ By doing this, Terrin becomes a legal & safe marketplace â€” no manual money handling, no tax headaches, no shady back-door deals.

âœ… Please implement this full flow â€” onboarding, account linking, PaymentIntent with destination, and Express Dashboard link â€” and confirm when ready for me to test.

